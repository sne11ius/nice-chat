<!DOCTYPE html>
<html>

<head>
    <title>nice chat</title>
    <link type="text/css" href="index.css" rel="stylesheet">
</head>

<img src="nice-chat-logo.png">

<section id="messages">
    <div id="isempty">[Keine Nachrichten]</div>
</section>

<section>
    <label for="username">Name:</label>
    <input type="text" id="username">
    <button id="start">Start!</button>
</section>

<section>
    <label for="message-input">Nachricht:</label>
    <input type="text" id="message-input" disabled>
    <button id="submit" disabled>Absenden</button>
</section>

<script>
    const startButton = document.getElementById('start')
    startButton.onclick = () => {
        const usernameInput = document.getElementById('username')
        const username = usernameInput.value
        if (username === '') {
            alert('Benutzername fehlt')
            return
        }
        const protocol = location.protocol.replace('http', 'ws')
        const socket = new WebSocket(protocol + "//" + location.host + '/chat/' + username);
        socket.onmessage = (message) => {
            const newElement = document.createElement('div')
            newElement.textContent = message.data
            const messageContainer = document.getElementById('messages')
            messageContainer.appendChild(newElement)
            const empty = document.getElementById('isempty')
            if (empty) {
                empty.remove()
            }
        }

        const button = document.getElementById('submit')
        button.removeAttribute('disabled')
        const input = document.getElementById('message-input')
        input.removeAttribute('disabled')
        const submit = () => {
            const messageText = input.value
            input.value = ''
            socket.send(messageText)
        }
        button.onclick = submit
        input.onkeyup = ({key}) => {
            if (key === 'Enter') {
                submit()
            }
        }
    }
</script>
</html>
